# 前后端集成说明

## 集成完成情况 ✅

### 后端（已完成）
- ✅ 检索器评估API（5个端点）
- ✅ T2Ranking数据集加载器
- ✅ 7个评估指标计算
- ✅ 数据存储层
- ✅ 完整文档和测试

### 前端（已完成）
- ✅ API客户端集成（`lib/api.ts`）
- ✅ 检索器评估视图组件（`components/views/retriever-evaluation.tsx`）
- ✅ 侧边栏菜单添加（`components/sidebar.tsx`）
- ✅ 主页面路由集成（`app/page.tsx`）

## 使用方法

### 1. 启动后端服务

```bash
cd backend
source .venv/bin/activate
python run.py
```

后端服务运行在: http://localhost:8000

### 2. 启动前端服务

```bash
cd web
npm install  # 首次运行需要安装依赖
npm run dev
```

前端服务运行在: http://localhost:3000

### 3. 访问检索器评估

1. 打开浏览器访问: http://localhost:3000
2. 在左侧菜单找到：**测试管理 > 检索器评估**
3. 点击进入检索器评估页面

## 功能说明

### 已集成的功能

#### 1. 数据集统计查询
- 点击"获取数据集统计"按钮
- 查看T2Ranking数据集的基本信息
- 显示文档数、查询数等统计指标

#### 2. 数据集导入
- 配置数据集路径
- 导入数据到知识库
- （注：需要配合文档向量化功能）

#### 3. 评估指标说明
- 展示7个核心评估指标
- Precision, Recall, F1, MRR, MAP, NDCG, Hit Rate

#### 4. 快速开始指南
- 页面内置使用步骤
- 帮助用户快速上手

## API接口对应关系

| 前端API方法 | 后端端点 | 说明 |
|------------|---------|------|
| `retrieverEvalAPI.getDatasetStatistics()` | `GET /retriever-evaluation/dataset-statistics` | 获取数据集统计 |
| `retrieverEvalAPI.importT2Ranking()` | `POST /retriever-evaluation/import-t2ranking` | 导入T2Ranking数据集 |
| `retrieverEvalAPI.evaluate()` | `POST /retriever-evaluation/evaluate` | 执行检索器评估 |
| `retrieverEvalAPI.getEvaluationHistory()` | `GET /retriever-evaluation/evaluation-history` | 获取评估历史 |
| `retrieverEvalAPI.compareEvaluations()` | `GET /retriever-evaluation/compare-evaluations` | 对比评估结果 |

## 文件清单

### 前端新增/修改文件

1. **`web/lib/api.ts`** - 添加检索器评估API接口
   - 新增 `retrieverEvalAPI` 对象
   - 5个API方法
   - TypeScript类型定义

2. **`web/components/views/retriever-evaluation.tsx`** - 检索器评估视图（新增）
   - 数据集统计卡片
   - 数据集导入功能
   - 评估指标说明
   - 快速开始指南

3. **`web/components/sidebar.tsx`** - 侧边栏菜单（修改）
   - 添加"检索器评估"菜单项

4. **`web/app/page.tsx`** - 主页面路由（修改）
   - 导入 `RetrieverEvaluationView`
   - 添加路由处理

## 测试步骤

### 1. 测试后端API

```bash
# 测试数据集统计API
curl -X GET "http://localhost:8000/api/v1/retriever-evaluation/dataset-statistics?collection_path=/Users/yeruijian/Documents/知识库平台/dataset/T2Ranking/data/collection.tsv&queries_path=/Users/yeruijian/Documents/知识库平台/dataset/T2Ranking/data/queries.dev.tsv&qrels_path=/Users/yeruijian/Documents/知识库平台/dataset/T2Ranking/data/qrels.dev.tsv&max_queries=100"
```

### 2. 测试前端界面

1. 启动前后端服务
2. 访问 http://localhost:3000
3. 点击"测试管理 > 检索器评估"
4. 点击"获取数据集统计"按钮
5. 查看统计信息是否正确显示

## 数据流

```
用户操作 → 前端组件 → API客户端 → 后端API → 服务层 → 数据处理 → 返回结果 → 前端展示
```

### 示例：获取数据集统计

1. **用户点击**按钮
2. **前端**调用 `retrieverEvalAPI.getDatasetStatistics()`
3. **API客户端**发送GET请求到 `/retriever-evaluation/dataset-statistics`
4. **后端控制器**接收请求
5. **数据集加载服务**处理TSV文件
6. **统计分析**生成结果
7. **返回JSON**响应
8. **前端组件**渲染统计卡片

## 配置说明

### 数据集路径配置

当前数据集路径硬编码在前端组件中：

```typescript
const defaultPaths = {
  collection: "/Users/yeruijian/Documents/知识库平台/dataset/T2Ranking/data/collection.tsv",
  queries: "/Users/yeruijian/Documents/知识库平台/dataset/T2Ranking/data/queries.dev.tsv",
  qrels: "/Users/yeruijian/Documents/知识库平台/dataset/T2Ranking/data/qrels.dev.tsv",
}
```

**优化建议：**
- 将路径配置移到环境变量或配置文件
- 支持用户在界面上输入自定义路径
- 添加路径验证功能

## 待完善功能

### 短期
- [ ] 完善数据集导入流程（需要文档向量化）
- [ ] 添加评估执行功能的UI
- [ ] 显示评估历史记录
- [ ] 评估结果对比界面

### 中期
- [ ] 评估结果可视化（图表）
- [ ] 配置管理界面
- [ ] 批量测试功能
- [ ] 实时进度显示

### 长期
- [ ] 自动化测试流程
- [ ] 性能趋势分析
- [ ] 导出评估报告
- [ ] A/B测试支持

## 注意事项

1. **CORS配置**
   - 后端已配置允许所有来源
   - 生产环境需要限制CORS策略

2. **数据集路径**
   - 确保后端有权限访问数据集文件
   - 路径使用绝对路径

3. **错误处理**
   - 前端已添加基础错误处理
   - 建议添加更详细的错误提示

4. **性能优化**
   - 大数据集使用采样功能
   - 考虑添加加载进度提示

## 快速验证

### 一键测试脚本

```bash
# 1. 启动后端
cd backend && source .venv/bin/activate && python run.py &

# 2. 等待2秒
sleep 2

# 3. 测试API
curl -s "http://localhost:8000/api/v1/health" | grep -q "healthy" && echo "✅ 后端服务正常"

# 4. 启动前端（新终端）
cd web && npm run dev
```

### 验证清单

- [ ] 后端服务启动成功（http://localhost:8000）
- [ ] 前端服务启动成功（http://localhost:3000）
- [ ] 可以访问检索器评估页面
- [ ] 数据集统计功能正常工作
- [ ] API调用返回正确结果

## 总结

✅ **前后端已完全打通！**

- 后端API完整实现并测试通过
- 前端组件开发完成并集成
- API接口对接完成
- 基础功能可以正常使用

**下一步：**
1. 启动前后端服务
2. 访问检索器评估页面
3. 测试数据集统计功能
4. 根据需求继续完善其他功能

🎉 现在可以开始使用检索器评估系统了！


# 快速开始

<cite>
**本文档引用的文件**
- [run.py](file://backend/run.py)
- [requirements.txt](file://backend/requirements.txt)
- [package.json](file://web/package.json)
- [QUICKSTART_链路测试.md](file://backend/QUICKSTART_链路测试.md)
- [README.md](file://web/README.md)
- [config.py](file://backend/app/config.py)
- [env.example](file://backend/env.example)
- [main.py](file://backend/app/main.py)
- [example_t2ranking_usage.py](file://backend/example_t2ranking_usage.py)
- [knowledge_base.py](file://backend/app/controllers/knowledge_base.py)
- [document.py](file://backend/app/controllers/document.py)
- [retriever_evaluation.py](file://backend/app/controllers/retriever_evaluation.py)
</cite>

## 目录
1. [简介](#简介)
2. [系统要求](#系统要求)
3. [环境准备](#环境准备)
4. [项目安装](#项目安装)
5. [服务启动](#服务启动)
6. [快速测试工作流](#快速测试工作流)
7. [常见问题排查](#常见问题排查)
8. [下一步学习](#下一步学习)

## 简介

RAG Studio是一个基于FastAPI和Next.js构建的检索增强生成（RAG）平台，提供了完整的知识库管理和检索器评估功能。本指南将帮助您在最短时间内完成环境搭建并运行第一个测试流程。

## 系统要求

### 硬件要求
- **CPU**: 至少2核
- **内存**: 至少4GB RAM
- **存储**: 至少10GB可用空间

### 软件要求
- **Python**: 3.8+ (推荐3.10+)
- **Node.js**: 18.0+ (推荐20.0+)
- **数据库**: MySQL 8.0+ 或 MariaDB
- **向量数据库**: Qdrant (默认) 或 Elasticsearch/Milvus (可选)

## 环境准备

### 1. 安装Python环境

```bash
# 检查Python版本
python --version
# 推荐使用Python 3.10或更高版本

# 创建虚拟环境（推荐）
python -m venv .venv
source .venv/bin/activate  # Linux/macOS
# 或
.venv\Scripts\activate     # Windows
```

### 2. 安装Node.js环境

```bash
# 检查Node.js版本
node --version
npm --version

# 推荐使用nvm管理Node.js版本
# macOS/Linux:
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20
nvm use 20

# Windows:
# 下载并安装Node.js: https://nodejs.org/
```

### 3. 安装数据库

#### MySQL安装（推荐）
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install mysql-server

# CentOS/RHEL
sudo yum install mysql-server

# macOS
brew install mysql
```

#### 启动数据库服务
```bash
# Ubuntu/Debian
sudo systemctl start mysql
sudo systemctl enable mysql

# macOS
brew services start mysql
```

### 4. 安装Ollama（AI服务）

```bash
# 下载并安装Ollama
# macOS/Linux:
curl -fsSL https://ollama.ai/install.sh | sh

# Windows:
# 下载安装包: https://ollama.ai/download

# 启动Ollama服务
ollama serve

# 拉取推荐的AI模型
ollama pull nomic-embed-text  # 嵌入模型
ollama pull deepseek-r1:1.5b  # 对话模型
```

## 项目安装

### 1. 克隆项目

```bash
git clone https://github.com/your-repository/rag-studio.git
cd rag-studio
```

### 2. 安装后端依赖

```bash
cd backend
pip install -r requirements.txt
```

### 3. 安装前端依赖

```bash
cd ../web
npm install
```

### 4. 配置环境变量

```bash
# 复制示例配置文件
cp ../backend/env.example .env

# 编辑.env文件（根据需要修改配置）
nano .env
```

**重要配置项：**
- `DB_HOST`: 数据库主机地址（默认localhost）
- `DB_USER`: 数据库用户名（默认root）
- `DB_PASSWORD`: 数据库密码
- `DB_NAME`: 数据库名称（默认rag_studio）
- `OLLAMA_BASE_URL`: Ollama服务地址（默认http://localhost:11434）
- `VECTOR_DB_TYPE`: 向量数据库类型（qdrant/elasticsearch/milvus）

## 服务启动

### 1. 启动后端FastAPI服务

```bash
cd backend
python run.py
```

**服务信息：**
- 主机地址: `http://localhost:8000`
- API文档: `http://localhost:8000/api/v1/docs`
- 健康检查: `http://localhost:8000/api/v1/health`

### 2. 启动前端Next.js应用

```bash
cd ../web
npm run dev
```

**前端信息：**
- 访问地址: `http://localhost:3000`
- 开发端口: `3000`

### 3. 验证服务状态

打开浏览器访问以下地址验证服务是否正常运行：

- **后端健康检查**: `http://localhost:8000/api/v1/health`
- **前端界面**: `http://localhost:3000`

**预期响应：**
```json
{
  "status": "healthy",
  "app_name": "RAG Studio Backend",
  "version": "1.0.0",
  "storage_type": "json",
  "vector_db": "qdrant"
}
```

## 快速测试工作流

### 工作流概述

我们将通过一个完整的测试流程演示RAG Studio的核心功能：
1. 创建知识库
2. 上传文档
3. 构建索引
4. 执行检索测试
5. 运行评估任务

### 方法一：使用测试脚本（推荐）

```bash
# 1. 进入backend目录并激活虚拟环境
cd backend
source .venv/bin/activate  # Linux/macOS
# 或
.venv\Scripts\activate     # Windows

# 2. 运行链路测试脚本
python test_t2ranking_pipeline.py
```

**预期输出：**
```
============================================================
T2Ranking数据集导入链路测试
============================================================

【步骤1】加载T2Ranking数据集...
✅ 数据集加载成功:
   - 文档数: 100
   - 查询数: 10
   ...

【步骤2】创建测试知识库...
✅ 知识库创建成功:
   - ID: kb_abc123
   ...

【步骤3】批量导入文档到知识库...
✅ 文档导入完成:
   - 成功创建: 100 个
   - 失败: 0 个

【步骤4】创建测试集...
✅ 测试集创建成功

【步骤5】批量创建测试用例...
✅ 测试用例创建完成:
   - 成功创建: 10 个

============================================================
✅ 链路测试完成！
============================================================
```

### 方法二：使用前端界面

#### 步骤1: 启动后端服务
```bash
cd backend
source .venv/bin/activate
python run.py
```

#### 步骤2: 启动前端服务
```bash
cd ../web
npm run dev
```

#### 步骤3: 访问Web界面
1. 打开浏览器访问 `http://localhost:3000`
2. 在侧边栏导航到"检索器评估"页面
3. 点击"获取数据集统计"查看T2Ranking数据集信息
4. 点击"导入数据集到知识库"开始导入
5. 查看导入结果（文档数、测试用例数等）

### 方法三：使用API直接测试

#### 1. 获取数据集统计信息
```bash
curl "http://localhost:8000/api/v1/retriever-evaluation/dataset-statistics?collection_path=/path/to/collection.tsv&queries_path=/path/to/queries.dev.tsv&qrels_path=/path/to/qrels.dev.tsv&max_queries=10"
```

#### 2. 创建知识库
```bash
curl -X POST "http://localhost:8000/api/v1/knowledge-bases" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "测试知识库",
    "description": "用于快速测试",
    "embedding_model": "nomic-embed-text",
    "vector_db_type": "qdrant"
  }'
```

**记录返回的知识库ID，如: `kb_abc123`**

#### 3. 导入数据集
```bash
curl -X POST "http://localhost:8000/api/v1/retriever-evaluation/import-t2ranking" \
  -H "Content-Type: application/json" \
  -d '{
    "kb_id": "kb_abc123",
    "test_set_name": "T2Ranking测试集",
    "collection_path": "/path/to/collection.tsv",
    "queries_path": "/path/to/queries.dev.tsv",
    "qrels_path": "/path/to/qrels.dev.tsv",
    "max_queries": 10,
    "description": "测试导入"
  }'
```

## 常见问题排查

### 1. 端口冲突

**问题**: 服务启动时提示端口被占用
```bash
# 错误示例
ERROR: Port 8000 is already in use
```

**解决方案**:
```bash
# 查找占用端口的进程
lsof -i :8000  # Linux/macOS
netstat -ano | findstr :8000  # Windows

# 终止占用进程
kill -9 <PID>  # Linux/macOS
taskkill /PID <PID> /F  # Windows

# 或修改配置文件使用其他端口
nano backend/.env
# 修改 PORT=8001
```

### 2. 依赖缺失

**问题**: 安装依赖时出现错误
```bash
# 错误示例
ModuleNotFoundError: No module named 'fastapi'
```

**解决方案**:
```bash
# 清理并重新安装
cd backend
pip uninstall fastapi uvicorn
pip install -r requirements.txt

# 或使用特定版本
pip install fastapi==0.104.1 uvicorn==0.24.0
```

### 3. 向量数据库连接失败

**问题**: 无法连接到向量数据库
```bash
# 错误示例
ConnectionError: Could not connect to Qdrant
```

**解决方案**:
```bash
# 检查Qdrant服务状态
docker ps | grep qdrant
# 或手动启动Qdrant
docker run -p 6333:6333 qdrant/qdrant

# 检查配置文件
nano backend/.env
# 确认 QDRANT_HOST 和 QDRANT_PORT 设置正确
```

### 4. Ollama服务不可用

**问题**: AI服务连接失败
```bash
# 错误示例
HTTPConnectionPool(host='localhost', port=11434): Max retries exceeded
```

**解决方案**:
```bash
# 检查Ollama服务状态
ollama list

# 启动Ollama服务
ollama serve

# 拉取必要模型
ollama pull nomic-embed-text
ollama pull deepseek-r1:1.5b
```

### 5. 数据库连接问题

**问题**: 数据库连接失败
```bash
# 错误示例
pymysql.err.OperationalError: (2003, "Can't connect to MySQL server")
```

**解决方案**:
```bash
# 检查MySQL服务状态
sudo systemctl status mysql

# 启动MySQL服务
sudo systemctl start mysql

# 检查数据库配置
nano backend/.env
# 确认 DB_HOST, DB_USER, DB_PASSWORD 正确
```

## 下一步学习

恭喜！您已经成功完成了RAG Studio的首次部署和测试。接下来您可以：

### 1. 深入学习核心功能
- **知识库管理**: 学习如何创建和管理多个知识库
- **文档处理**: 了解文档上传、解析和向量化过程
- **检索功能**: 探索不同检索策略的效果对比

### 2. 实践案例
- **自定义数据集**: 使用自己的文档进行测试
- **模型调优**: 尝试不同的嵌入模型和检索参数
- **性能评估**: 运行更全面的评估任务

### 3. 技术进阶
- **架构理解**: 深入了解RAG系统的整体架构
- **扩展开发**: 学习如何添加新的评估指标
- **生产部署**: 准备项目上线到生产环境

### 4. 社区参与
- **贡献代码**: 参与开源项目开发
- **问题反馈**: 报告遇到的问题和改进建议
- **经验分享**: 分享您的使用经验和最佳实践

**祝您在RAG Studio的学习和实践中取得丰硕成果！**